<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ReactOS: E:/ReactOS-0.4.6/win32ss/gdi/gdi32/objects/utils.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ReactOS
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','搜索');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">E:/ReactOS-0.4.6/win32ss/gdi/gdi32/objects/utils.c</div>  </div>
</div><!--header-->
<div class="contents">
<p>PBITMAPINFO NewBitmapInfo; UINT NewBitmapInfoSize;</p>
<p>NewBitmapInfo = ConvertBitmapInfo(OldBitmapInfo, DIB_RGB_COLORS, &amp;NewBitmapInfoSize, FALSE); if (NewBitmapInfo) { &lt;do something="" with="" the="" bitmap="" info&gt;=""&gt; if (NewBitmapInfo != OldBitmapInfo) RtlFreeHeap(RtlGetProcessHeap(), 0, NewBitmapInfo); }</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;precomp.h&gt;</span></div><div class="line"></div><div class="line">BOOL WINAPI</div><div class="line">CalculateColorTableSize(</div><div class="line">    CONST <a name="_a0"></a><a class="code" href="struct_b_i_t_m_a_p_i_n_f_o_h_e_a_d_e_r.html">BITMAPINFOHEADER</a> *BitmapInfoHeader,</div><div class="line">    UINT *ColorSpec,</div><div class="line">    UINT *ColorTableSize)</div><div class="line">{</div><div class="line">    WORD BitCount;</div><div class="line">    DWORD ClrUsed;</div><div class="line">    DWORD Compression;</div><div class="line"></div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">     * At first get some basic parameters from the passed BitmapInfoHeader</span></div><div class="line"><span class="comment">     * structure. It can have one of the following formats:</span></div><div class="line"><span class="comment">     * - BITMAPCOREHEADER (the oldest one with totally different layout</span></div><div class="line"><span class="comment">     *                     from the others)</span></div><div class="line"><span class="comment">     * - BITMAPINFOHEADER (the standard and most common header)</span></div><div class="line"><span class="comment">     * - BITMAPV4HEADER (extension of BITMAPINFOHEADER)</span></div><div class="line"><span class="comment">     * - BITMAPV5HEADER (extension of BITMAPV4HEADER)</span></div><div class="line"><span class="comment">     */</span></div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (BitmapInfoHeader-&gt;biSize == <span class="keyword">sizeof</span>(<a name="_a1"></a><a class="code" href="structtag_b_i_t_m_a_p_c_o_r_e_h_e_a_d_e_r.html">BITMAPCOREHEADER</a>))</div><div class="line">    {</div><div class="line">        BitCount = ((<a class="code" href="structtag_b_i_t_m_a_p_c_o_r_e_h_e_a_d_e_r.html">LPBITMAPCOREHEADER</a>)BitmapInfoHeader)-&gt;bcBitCount;</div><div class="line">        ClrUsed = 0;</div><div class="line">        Compression = BI_RGB;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        BitCount = BitmapInfoHeader-&gt;biBitCount;</div><div class="line">        ClrUsed = BitmapInfoHeader-&gt;biClrUsed;</div><div class="line">        Compression = BitmapInfoHeader-&gt;biCompression;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">switch</span> (Compression)</div><div class="line">    {</div><div class="line">    <span class="keywordflow">case</span> BI_BITFIELDS:</div><div class="line">        <span class="keywordflow">if</span> (*ColorSpec == DIB_PAL_COLORS)</div><div class="line">            *ColorSpec = DIB_RGB_COLORS;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (BitCount != 16 &amp;&amp; BitCount != 32)</div><div class="line">            <span class="keywordflow">return</span> FALSE;</div><div class="line"></div><div class="line">        <span class="comment">/*</span></div><div class="line"><span class="comment">         * For BITMAPV4HEADER/BITMAPV5HEADER the masks are included in</span></div><div class="line"><span class="comment">         * the structure itself (bV4RedMask, bV4GreenMask, and bV4BlueMask).</span></div><div class="line"><span class="comment">         * For BITMAPINFOHEADER the color masks are stored in the palette.</span></div><div class="line"><span class="comment">         */</span></div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (BitmapInfoHeader-&gt;biSize &gt; <span class="keyword">sizeof</span>(<a class="code" href="struct_b_i_t_m_a_p_i_n_f_o_h_e_a_d_e_r.html">BITMAPINFOHEADER</a>))</div><div class="line">            *ColorTableSize = 0;</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">            *ColorTableSize = 3;</div><div class="line"></div><div class="line">        <span class="keywordflow">return</span> TRUE;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> BI_RGB:</div><div class="line">        <span class="keywordflow">switch</span> (BitCount)</div><div class="line">        {</div><div class="line">        <span class="keywordflow">case</span> 1:</div><div class="line">            *ColorTableSize = ClrUsed ? min(ClrUsed, 2) : 2;</div><div class="line">            <span class="keywordflow">return</span> TRUE;</div><div class="line"></div><div class="line">        <span class="keywordflow">case</span> 4:</div><div class="line">            *ColorTableSize = ClrUsed ? min(ClrUsed, 16) : 16;</div><div class="line">            <span class="keywordflow">return</span> TRUE;</div><div class="line"></div><div class="line">        <span class="keywordflow">case</span> 8:</div><div class="line">            *ColorTableSize = ClrUsed ? min(ClrUsed, 256) : 256;</div><div class="line">            <span class="keywordflow">return</span> TRUE;</div><div class="line"></div><div class="line">        <span class="keywordflow">default</span>:</div><div class="line">            <span class="keywordflow">if</span> (*ColorSpec == DIB_PAL_COLORS)</div><div class="line">                *ColorSpec = DIB_RGB_COLORS;</div><div class="line">            <span class="keywordflow">if</span> (BitCount != 16 &amp;&amp; BitCount != 24 &amp;&amp; BitCount != 32)</div><div class="line">                <span class="keywordflow">return</span> FALSE;</div><div class="line">            *ColorTableSize = ClrUsed;</div><div class="line">            <span class="keywordflow">return</span> TRUE;</div><div class="line">        }</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> BI_RLE4:</div><div class="line">        <span class="keywordflow">if</span> (BitCount == 4)</div><div class="line">        {</div><div class="line">            *ColorTableSize = ClrUsed ? min(ClrUsed, 16) : 16;</div><div class="line">            <span class="keywordflow">return</span> TRUE;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">return</span> FALSE;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> BI_RLE8:</div><div class="line">        <span class="keywordflow">if</span> (BitCount == 8)</div><div class="line">        {</div><div class="line">            *ColorTableSize = ClrUsed ? min(ClrUsed, 256) : 256;</div><div class="line">            <span class="keywordflow">return</span> TRUE;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">return</span> FALSE;</div><div class="line"></div><div class="line">    <span class="keywordflow">case</span> BI_JPEG:</div><div class="line">    <span class="keywordflow">case</span> BI_PNG:</div><div class="line">        *ColorTableSize = ClrUsed;</div><div class="line">        <span class="keywordflow">return</span> TRUE;</div><div class="line"></div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        <span class="keywordflow">return</span> FALSE;</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><a name="_a2"></a><a class="code" href="structtag_b_i_t_m_a_p_i_n_f_o.html">LPBITMAPINFO</a> WINAPI</div><div class="line">ConvertBitmapInfo(</div><div class="line">    CONST <a class="code" href="structtag_b_i_t_m_a_p_i_n_f_o.html">BITMAPINFO</a> *BitmapInfo,</div><div class="line">    UINT ColorSpec,</div><div class="line">    UINT *BitmapInfoSize,</div><div class="line">    BOOL FollowedByData)</div><div class="line">{</div><div class="line">    <a class="code" href="structtag_b_i_t_m_a_p_i_n_f_o.html">LPBITMAPINFO</a> NewBitmapInfo = (<a class="code" href="structtag_b_i_t_m_a_p_i_n_f_o.html">LPBITMAPINFO</a>)BitmapInfo;</div><div class="line">    <a name="_a3"></a><a class="code" href="struct___b_i_t_m_a_p_c_o_r_e_i_n_f_o.html">LPBITMAPCOREINFO</a> CoreBitmapInfo = (<a class="code" href="struct___b_i_t_m_a_p_c_o_r_e_i_n_f_o.html">LPBITMAPCOREINFO</a>)BitmapInfo;</div><div class="line">    DWORD Size = 0;</div><div class="line">    ULONG DataSize = 0;</div><div class="line">    UINT PaletteEntryCount = 0;</div><div class="line"></div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">     * At first check if the passed BitmapInfo structure has valid size. It</span></div><div class="line"><span class="comment">     * can have one of these headers: BITMAPCOREHEADER, BITMAPINFOHEADER,</span></div><div class="line"><span class="comment">     * BITMAPV4HEADER or BITMAPV5HEADER (see CalculateColorTableSize for</span></div><div class="line"><span class="comment">     * description).</span></div><div class="line"><span class="comment">     */</span></div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> ( !BitmapInfo ||</div><div class="line">            (BitmapInfo-&gt;bmiHeader.biSize != <span class="keyword">sizeof</span>(<a class="code" href="structtag_b_i_t_m_a_p_c_o_r_e_h_e_a_d_e_r.html">BITMAPCOREHEADER</a>) &amp;&amp;</div><div class="line">             (BitmapInfo-&gt;bmiHeader.biSize &lt; <span class="keyword">sizeof</span>(<a class="code" href="struct_b_i_t_m_a_p_i_n_f_o_h_e_a_d_e_r.html">BITMAPINFOHEADER</a>) ||</div><div class="line">              BitmapInfo-&gt;bmiHeader.biSize &gt; <span class="keyword">sizeof</span>(BITMAPV5HEADER))))</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> NULL;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">     * Now calculate the color table size. Also if the bitmap info contains</span></div><div class="line"><span class="comment">     * invalid color information it&#39;s rejected here.</span></div><div class="line"><span class="comment">     */</span></div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (!CalculateColorTableSize(&amp;BitmapInfo-&gt;bmiHeader, &amp;ColorSpec,</div><div class="line">                                 &amp;PaletteEntryCount))</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> NULL;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">     * Calculate the size of image data if applicable. We must be careful</span></div><div class="line"><span class="comment">     * to do proper aligning on line ends.</span></div><div class="line"><span class="comment">     */</span></div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (FollowedByData)</div><div class="line">    {</div><div class="line">        DataSize = GdiGetBitmapBitsSize((<a class="code" href="structtag_b_i_t_m_a_p_i_n_f_o.html">PBITMAPINFO</a>)BitmapInfo );</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">     * If BitmapInfo was originally BITMAPCOREINFO then we need to convert</span></div><div class="line"><span class="comment">     * it to the standard BITMAPINFO layout.</span></div><div class="line"><span class="comment">     */</span></div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (BitmapInfo-&gt;bmiHeader.biSize == <span class="keyword">sizeof</span>(<a class="code" href="structtag_b_i_t_m_a_p_c_o_r_e_h_e_a_d_e_r.html">BITMAPCOREHEADER</a>))</div><div class="line">    {</div><div class="line">        Size = <span class="keyword">sizeof</span>(<a class="code" href="struct_b_i_t_m_a_p_i_n_f_o_h_e_a_d_e_r.html">BITMAPINFOHEADER</a>);</div><div class="line">        <span class="keywordflow">if</span> (ColorSpec == DIB_RGB_COLORS)</div><div class="line">            Size += PaletteEntryCount * <span class="keyword">sizeof</span>(<a name="_a4"></a><a class="code" href="structtag_r_g_b_q_u_a_d.html">RGBQUAD</a>);</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">            Size += PaletteEntryCount * <span class="keyword">sizeof</span>(USHORT);</div><div class="line">        Size += DataSize;</div><div class="line"></div><div class="line">        NewBitmapInfo = RtlAllocateHeap(RtlGetProcessHeap(), 0, Size);</div><div class="line">        <span class="keywordflow">if</span> (NewBitmapInfo == NULL)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">return</span> NULL;</div><div class="line">        }</div><div class="line"></div><div class="line">        NewBitmapInfo-&gt;<a name="a5"></a>bmiHeader.<a name="a6"></a>biSize = <span class="keyword">sizeof</span>(<a class="code" href="struct_b_i_t_m_a_p_i_n_f_o_h_e_a_d_e_r.html">BITMAPINFOHEADER</a>);</div><div class="line">        NewBitmapInfo-&gt;bmiHeader.<a name="a7"></a>biWidth = CoreBitmapInfo-&gt;<a name="a8"></a>bmciHeader.<a name="a9"></a>bcWidth;</div><div class="line">        NewBitmapInfo-&gt;bmiHeader.<a name="a10"></a>biHeight = CoreBitmapInfo-&gt;bmciHeader.<a name="a11"></a>bcHeight;</div><div class="line">        NewBitmapInfo-&gt;bmiHeader.<a name="a12"></a>biPlanes = CoreBitmapInfo-&gt;bmciHeader.<a name="a13"></a>bcPlanes;</div><div class="line">        NewBitmapInfo-&gt;bmiHeader.<a name="a14"></a>biBitCount = CoreBitmapInfo-&gt;bmciHeader.<a name="a15"></a>bcBitCount;</div><div class="line">        NewBitmapInfo-&gt;bmiHeader.<a name="a16"></a>biCompression = BI_RGB;</div><div class="line">        NewBitmapInfo-&gt;bmiHeader.<a name="a17"></a>biSizeImage = 0;</div><div class="line">        NewBitmapInfo-&gt;bmiHeader.<a name="a18"></a>biXPelsPerMeter = 0;</div><div class="line">        NewBitmapInfo-&gt;bmiHeader.<a name="a19"></a>biYPelsPerMeter = 0;</div><div class="line">        NewBitmapInfo-&gt;bmiHeader.<a name="a20"></a>biClrUsed = 0;</div><div class="line">        NewBitmapInfo-&gt;bmiHeader.<a name="a21"></a>biClrImportant = 0;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (PaletteEntryCount != 0)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (ColorSpec == DIB_RGB_COLORS)</div><div class="line">            {</div><div class="line">                ULONG Index;</div><div class="line"></div><div class="line">                <span class="keywordflow">for</span> (Index = 0; Index &lt; PaletteEntryCount; Index++)</div><div class="line">                {</div><div class="line">                    NewBitmapInfo-&gt;<a name="a22"></a>bmiColors[Index].<a name="a23"></a>rgbRed =</div><div class="line">                        CoreBitmapInfo-&gt;<a name="a24"></a>bmciColors[Index].<a name="a25"></a>rgbtRed;</div><div class="line">                    NewBitmapInfo-&gt;bmiColors[Index].<a name="a26"></a>rgbGreen =</div><div class="line">                        CoreBitmapInfo-&gt;bmciColors[Index].<a name="a27"></a>rgbtGreen;</div><div class="line">                    NewBitmapInfo-&gt;bmiColors[Index].<a name="a28"></a>rgbBlue =</div><div class="line">                        CoreBitmapInfo-&gt;bmciColors[Index].<a name="a29"></a>rgbtBlue;</div><div class="line">                    NewBitmapInfo-&gt;bmiColors[Index].<a name="a30"></a>rgbReserved = 0;</div><div class="line">                }</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">                RtlCopyMemory(NewBitmapInfo-&gt;bmiColors,</div><div class="line">                              CoreBitmapInfo-&gt;bmciColors,</div><div class="line">                              PaletteEntryCount * <span class="keyword">sizeof</span>(USHORT));</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (FollowedByData)</div><div class="line">        {</div><div class="line">            ULONG_PTR NewDataPtr, OldDataPtr;</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (ColorSpec == DIB_RGB_COLORS)</div><div class="line">            {</div><div class="line">                NewDataPtr = (ULONG_PTR)(NewBitmapInfo-&gt;bmiColors +</div><div class="line">                                         PaletteEntryCount);</div><div class="line">                OldDataPtr = (ULONG_PTR)(CoreBitmapInfo-&gt;bmciColors +</div><div class="line">                                         PaletteEntryCount);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">                NewDataPtr = (ULONG_PTR)(NewBitmapInfo-&gt;bmiColors) +</div><div class="line">                             PaletteEntryCount * <span class="keyword">sizeof</span>(USHORT);</div><div class="line">                OldDataPtr = (ULONG_PTR)(CoreBitmapInfo-&gt;bmciColors) +</div><div class="line">                             PaletteEntryCount * <span class="keyword">sizeof</span>(USHORT);</div><div class="line">            }</div><div class="line"></div><div class="line">            RtlCopyMemory((<a name="_a31"></a><a class="code" href="interfacevoid.html">PVOID</a>)NewDataPtr, (<a class="code" href="interfacevoid.html">PVOID</a>)OldDataPtr, DataSize);</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        <span class="comment">/* Verify some data validity */</span></div><div class="line">        <span class="keywordflow">switch</span> (BitmapInfo-&gt;bmiHeader.biCompression)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">case</span> BI_RLE8:</div><div class="line">                <span class="keywordflow">if</span> (BitmapInfo-&gt;bmiHeader.biBitCount != 8)</div><div class="line">                    <span class="keywordflow">return</span> NULL;</div><div class="line">                <span class="keywordflow">if</span> (BitmapInfo-&gt;bmiHeader.biHeight &lt; 0)</div><div class="line">                    <span class="keywordflow">return</span> NULL;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> BI_RLE4:</div><div class="line">                <span class="keywordflow">if</span> (BitmapInfo-&gt;bmiHeader.biBitCount != 4)</div><div class="line">                    <span class="keywordflow">return</span> NULL;</div><div class="line">                <span class="keywordflow">if</span> (BitmapInfo-&gt;bmiHeader.biHeight &lt; 0)</div><div class="line">                    <span class="keywordflow">return</span> NULL;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">default</span>:</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">/* Non &quot;standard&quot; formats must have a valid size set */</span></div><div class="line">        <span class="keywordflow">if</span> ((BitmapInfo-&gt;bmiHeader.biCompression != BI_RGB) &amp;&amp;</div><div class="line">                (BitmapInfo-&gt;bmiHeader.biCompression != BI_BITFIELDS))</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (BitmapInfo-&gt;bmiHeader.biSizeImage == 0)</div><div class="line">                <span class="keywordflow">return</span> NULL;</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    Size = NewBitmapInfo-&gt;bmiHeader.biSize;</div><div class="line">    <span class="keywordflow">if</span> (ColorSpec == DIB_RGB_COLORS)</div><div class="line">        Size += PaletteEntryCount * <span class="keyword">sizeof</span>(<a class="code" href="structtag_r_g_b_q_u_a_d.html">RGBQUAD</a>);</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">        Size += PaletteEntryCount * <span class="keyword">sizeof</span>(USHORT);</div><div class="line">    Size += DataSize;</div><div class="line">    *BitmapInfoSize = Size;</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> NewBitmapInfo;</div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="interfacevoid.html">VOID</a></div><div class="line">WINAPI</div><div class="line">LogFontA2W(<a name="_a32"></a><a class="code" href="structtag_l_o_g_f_o_n_t_w.html">LPLOGFONTW</a> pW, CONST <a name="_a33"></a><a class="code" href="struct_l_o_g_f_o_n_t_a.html">LOGFONTA</a> *pA)</div><div class="line">{</div><div class="line"><span class="preprocessor">#define COPYS(f,len) MultiByteToWideChar ( CP_THREAD_ACP, 0, pA-&gt;f, len, pW-&gt;f, len )</span></div><div class="line"><span class="preprocessor">#define COPYN(f) pW-&gt;f = pA-&gt;f</span></div><div class="line"></div><div class="line">    COPYN(lfHeight);</div><div class="line">    COPYN(lfWidth);</div><div class="line">    COPYN(lfEscapement);</div><div class="line">    COPYN(lfOrientation);</div><div class="line">    COPYN(lfWeight);</div><div class="line">    COPYN(lfItalic);</div><div class="line">    COPYN(lfUnderline);</div><div class="line">    COPYN(lfStrikeOut);</div><div class="line">    COPYN(lfCharSet);</div><div class="line">    COPYN(lfOutPrecision);</div><div class="line">    COPYN(lfClipPrecision);</div><div class="line">    COPYN(lfQuality);</div><div class="line">    COPYN(lfPitchAndFamily);</div><div class="line">    COPYS(lfFaceName,LF_FACESIZE);</div><div class="line">    pW-&gt;<a name="a34"></a>lfFaceName[LF_FACESIZE - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"></div><div class="line"><span class="preprocessor">#undef COPYN</span></div><div class="line"><span class="preprocessor">#undef COPYS</span></div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="interfacevoid.html">VOID</a></div><div class="line">WINAPI</div><div class="line">LogFontW2A(<a name="_a35"></a><a class="code" href="structtag_l_o_g_f_o_n_t_a.html">LPLOGFONTA</a> pA, CONST <a name="_a36"></a><a class="code" href="struct_l_o_g_f_o_n_t_w.html">LOGFONTW</a> *pW)</div><div class="line">{</div><div class="line"><span class="preprocessor">#define COPYS(f,len) WideCharToMultiByte ( CP_THREAD_ACP, 0, pW-&gt;f, len, pA-&gt;f, len, NULL, NULL )</span></div><div class="line"><span class="preprocessor">#define COPYN(f) pA-&gt;f = pW-&gt;f</span></div><div class="line"></div><div class="line">    COPYN(lfHeight);</div><div class="line">    COPYN(lfWidth);</div><div class="line">    COPYN(lfEscapement);</div><div class="line">    COPYN(lfOrientation);</div><div class="line">    COPYN(lfWeight);</div><div class="line">    COPYN(lfItalic);</div><div class="line">    COPYN(lfUnderline);</div><div class="line">    COPYN(lfStrikeOut);</div><div class="line">    COPYN(lfCharSet);</div><div class="line">    COPYN(lfOutPrecision);</div><div class="line">    COPYN(lfClipPrecision);</div><div class="line">    COPYN(lfQuality);</div><div class="line">    COPYN(lfPitchAndFamily);</div><div class="line">    COPYS(lfFaceName,LF_FACESIZE);</div><div class="line">    pA-&gt;<a name="a37"></a>lfFaceName[LF_FACESIZE - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"></div><div class="line"><span class="preprocessor">#undef COPYN</span></div><div class="line"><span class="preprocessor">#undef COPYS</span></div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="interfacevoid.html">VOID</a></div><div class="line">WINAPI</div><div class="line">EnumLogFontExW2A( <a name="_a38"></a><a class="code" href="structtag_e_n_u_m_l_o_g_f_o_n_t_e_x_a.html">LPENUMLOGFONTEXA</a> fontA, CONST <a name="_a39"></a><a class="code" href="structtag_e_n_u_m_l_o_g_f_o_n_t_e_x_w.html">ENUMLOGFONTEXW</a> *fontW )</div><div class="line">{</div><div class="line">    LogFontW2A( (<a class="code" href="structtag_l_o_g_f_o_n_t_a.html">LPLOGFONTA</a>)fontA, (CONST <a class="code" href="struct_l_o_g_f_o_n_t_w.html">LOGFONTW</a> *)fontW );</div><div class="line"></div><div class="line">    WideCharToMultiByte( CP_THREAD_ACP, 0, fontW-&gt;elfFullName, -1,</div><div class="line">                         (LPSTR) fontA-&gt;elfFullName, LF_FULLFACESIZE, NULL, NULL );</div><div class="line">    fontA-&gt;elfFullName[LF_FULLFACESIZE-1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line">    WideCharToMultiByte( CP_THREAD_ACP, 0, fontW-&gt;elfStyle, -1,</div><div class="line">                         (LPSTR) fontA-&gt;elfStyle, LF_FACESIZE, NULL, NULL );</div><div class="line">    fontA-&gt;elfStyle[LF_FACESIZE-1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line">    WideCharToMultiByte( CP_THREAD_ACP, 0, fontW-&gt;elfScript, -1,</div><div class="line">                         (LPSTR) fontA-&gt;elfScript, LF_FACESIZE, NULL, NULL );</div><div class="line">    fontA-&gt;elfScript[LF_FACESIZE-1] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line">}</div><div class="line"></div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
制作者 &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
